name: AI Note Auto Posting

on:
  workflow_dispatch:
    inputs:
      theme:
        description: '記事のテーマ'
        required: true
        default: 'AI活用術'
      target:
        description: '想定読者'
        required: true
        default: 'ビジネスパーソン'
      message:
        description: '伝えたい核メッセージ'
        required: true
        default: 'AIで生産性向上'
      cta:
        description: '読後のアクション'
        required: false
        default: '実際に試してみる'
      is_public:
        description: '公開する（true/false）'
        required: true
        default: 'false'

jobs:
  ai-generate-and-post:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install dependencies
      run: |
        npm install puppeteer @anthropic-ai/sdk
        
    - name: Generate and Post Article
      env:
        ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        NOTE_STORAGE_STATE_JSON: ${{ secrets.NOTE_STORAGE_STATE_JSON }}
        NOTE_EMAIL: ${{ secrets.NOTE_EMAIL }}
        NOTE_PASSWORD: ${{ secrets.NOTE_PASSWORD }}
      run: |
        echo "AI記事生成開始"
        node post.mjs ai "${{ github.event.inputs.theme }}" "${{ github.event.inputs.target }}" "${{ github.event.inputs.message }}" "${{ github.event.inputs.cta }}" "${{ github.event.inputs.is_public }}"
        echo "処理完了"
